language: python
cache: pip
matrix:
  include:
    - os: osx
      language: sh
      python: "3.7"
      env:
        - TOXENV=py3
        - HOMEBREW_NO_INSTALL_CLEANUP=1
        - HOMEBREW_NO_ANALYTICS=1
      before_cache:
        # - brew cleanup
        - rm -f "$HOME/Library/Caches/pip/log/debug.log"
      cache:
        directories:
          # - "$HOME/Library/Caches/Homebrew"
          - "$HOME/Library/Caches/pip"
      addons:
        homebrew:
          # update: true
          packages: python3
      before_install:
        - python3 -m pip install --upgrade virtualenv
        - virtualenv -p python3 --system-site-packages "$HOME/venv"
        - source "$HOME/venv/bin/activate"
      install: pip install --upgrade mock
    - os: windows
      language: sh
      python: "3.7"
      cache:
        directories:
          - $LOCALAPPDATA/pip/Cache
      before_install:
        - choco install python3
        - export PATH="/c/Python37:/c/Python37/Scripts:$PATH"
        - python -m pip install --upgrade pip wheel
        - python -m pip install mock
    - python: 3.6.7
      dist: xenial
      sudo: true
    - python: 3.7.2
      dist: xenial
      sudo: true


install:
  - pip install .
  - pip install codecov
  - pip install pytest
  - pip install pytest-cov

# command to run tests
script:
  - python3 -m pytest --cov=gphotos --log-format='%(asctime)s.%(msecs)03d %(filename)-25s %(lineno)4d %(levelname)-8s %(message)s' --log-date-format='%Y-%m-%d %H:%M:%S' --log-level debug

# submit coverage
after_script:
 - codecov --token=dbadb6ba-0032-4812-bcc2-67ef7bafdfed
